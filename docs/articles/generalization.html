<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="causalTransportR">
<title>Effect Generalization • causalTransportR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.2/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.2/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Effect Generalization">
<meta property="og:description" content="causalTransportR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">causalTransportR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/generalization.html">Effect Generalization</a>
    <a class="dropdown-item" href="../articles/mlrate.html">Covariate Adjustment using ML predictions</a>
    <a class="dropdown-item" href="../articles/omnibus.html">Omnibus Tests for Treatment Effect Heterogeneity</a>
    <a class="dropdown-item" href="../articles/tech_details.html">Technical Details : identification and estimation</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="generalization_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Effect Generalization</h1>
                        <h4 data-toc-skip class="author">Apoorva Lal</h4>
            
            <h4 data-toc-skip class="date">2022-10-23</h4>
      
      
      <div class="d-none name"><code>generalization.Rmd</code></div>
    </div>

    
    
<!--- For HTML renders - selection from math_shortcuts.tex --->
<p><span class="math inline">\(\DeclareMathOperator*{\argmin}{argmin}\)</span> <span class="math inline">\(\newcommand{\abs}[1]{\left\vert {#1} \right\vert}\)</span> <span class="math inline">\(\newcommand{\indep}{\perp\!\!\!\perp}\)</span> <span class="math inline">\(\newcommand{\var}{\mathrm{Var}}\)</span> <span class="math inline">\(\newcommand{\ephi}{\varephilon}\)</span> <span class="math inline">\(\newcommand{\phii}{\varphi}\)</span> <span class="math inline">\(\newcommand{\tra}{^{\top}}\)</span> <span class="math inline">\(\newcommand{\sumin}{\sum_{i=1}^n}\)</span> <span class="math inline">\(\newcommand{\sumiN}{\sum_{i=1}^n}\)</span> <span class="math inline">\(\newcommand{\norm}[1]{\left\Vert{#1} \right\Vert}\)</span> <span class="math inline">\(\newcommand\Bigpar[1]{\left( #1 \right )}\)</span> <span class="math inline">\(\newcommand\Bigbr[1]{\left[ #1 \right ]}\)</span> <span class="math inline">\(\newcommand\Bigcr[1]{\left\{ #1 \right \}}\)</span> <span class="math inline">\(\newcommand\SetB[1]{\left\{ #1 \right\}}\)</span> <span class="math inline">\(\newcommand\Sett[1]{\mathcal{#1}}\)</span> <span class="math inline">\(\newcommand{\Data}{\mathcal{D}}\)</span> <span class="math inline">\(\newcommand{\Ubr}[2]{\underbrace{#1}_{\text{#2}}}\)</span> <span class="math inline">\(\newcommand{\Obr}[2]{ \overbrace{#1}^{\text{#2}}}\)</span> <span class="math inline">\(\newcommand{\sumiN}{\sum_{i=1}^N}\)</span> <span class="math inline">\(\newcommand{\dydx}[2]{\frac{\partial #1}{\partial #2}}\)</span> <span class="math inline">\(\newcommand\Indic[1]{\mathbb{1}_{#1}}\)</span> <span class="math inline">\(\newcommand{\Realm}[1]{\mathbb{R}^{#1}}\)</span> <span class="math inline">\(\newcommand{\Exp}[1]{\mathbb{E}\left[#1\right]}\)</span> <span class="math inline">\(\newcommand{\Expt}[2]{\mathbb{E}_{#1}\left[#2\right]}\)</span> <span class="math inline">\(\newcommand{\Var}[1]{\mathbb{V}\left[#1\right]}\)</span> <span class="math inline">\(\newcommand{\Covar}[1]{\text{Cov}\left[#1\right]}\)</span> <span class="math inline">\(\newcommand{\Prob}[1]{\mathbf{Pr}\left(#1\right)}\)</span> <span class="math inline">\(\newcommand{\Supp}[1]{\text{Supp}\left[#1\right]}\)</span> <span class="math inline">\(\newcommand{\doyx}{\Prob{Y \, |\,\mathsf{do} (X = x)}}\)</span> <span class="math inline">\(\newcommand{\doo}[1]{\Prob{Y |\,\mathsf{do} (#1) }}\)</span> <span class="math inline">\(\newcommand{\R}{\mathbb{R}}\)</span> <span class="math inline">\(\newcommand{\Z}{\mathbb{Z}}\)</span> <span class="math inline">\(\newcommand{\wh}[1]{\widehat{#1}}\)</span> <span class="math inline">\(\newcommand{\wt}[1]{\widetilde{#1}}\)</span> <span class="math inline">\(\newcommand{\wb}[1]{\overline{#1}}\)</span> <span class="math inline">\(\newcommand\Ol[1]{\overline{#1}}\)</span> <span class="math inline">\(\newcommand\Ul[1]{\underline{#1}}\)</span> <span class="math inline">\(\newcommand\Str[1]{#1^{*}}\)</span> <span class="math inline">\(\newcommand{\F}{\mathsf{F}}\)</span> <span class="math inline">\(\newcommand{\ff}{\mathsf{f}}\)</span> <span class="math inline">\(\newcommand{\Cdf}[1]{\mathbb{F}\left(#1\right)}\)</span> <span class="math inline">\(\newcommand{\Cdff}[2]{\mathbb{F}_{#1}\left(#2\right)}\)</span> <span class="math inline">\(\newcommand{\Pdf}[1]{\mathsf{f}\left(#1\right)}\)</span> <span class="math inline">\(\newcommand{\Pdff}[2]{\mathsf{f}_{#1}\left(#2\right)}\)</span> <span class="math inline">\(\newcommand{\dd}{\mathsf{d}}\)</span> <span class="math inline">\(\newcommand\Normal[1]{\mathcal{N} \left( #1 \right )}\)</span> <span class="math inline">\(\newcommand\Unif[1]{\mathsf{U} \left[ #1 \right ]}\)</span> <span class="math inline">\(\newcommand\Bern[1]{\mathsf{Bernoulli} \left( #1 \right )}\)</span> <span class="math inline">\(\newcommand\Binom[1]{\mathsf{Bin} \left( #1 \right )}\)</span> <span class="math inline">\(\newcommand\Pois[1]{\mathsf{Poi} \left( #1 \right )}\)</span> <span class="math inline">\(\newcommand\BetaD[1]{\mathsf{Beta} \left( #1 \right )}\)</span> <span class="math inline">\(\newcommand\Diri[1]{\mathsf{Dir} \left( #1 \right )}\)</span> <span class="math inline">\(\newcommand\Gdist[1]{\mathsf{Gamma} \left( #1 \right )}\)</span> <span class="math inline">\(\def\mbf#1{\mathbf{#1}}\)</span> <span class="math inline">\(\def\mrm#1{\mathrm{#1}}\)</span> <span class="math inline">\(\def\mbi#1{\boldsymbol{#1}}\)</span> <span class="math inline">\(\def\ve#1{\mbi{#1}}\)</span> <span class="math inline">\(\def\vee#1{\mathbf{#1}}\)</span> <span class="math inline">\(\newcommand{\Mat}[1]{\mathbf{#1}}\)</span> <span class="math inline">\(\newcommand{\eucN}[1]{\norm{#1}}\)</span> <span class="math inline">\(\newcommand{\lzero}[1]{\norm{#1}_0}\)</span> <span class="math inline">\(\newcommand{\lone}[1]{\norm{#1}_1}\)</span> <span class="math inline">\(\newcommand{\ltwo}[1]{\norm{#1}_2}\)</span> <span class="math inline">\(\newcommand{\pnorm}[1]{\norm{#1}_p}\)</span></p>
<p>We simulate some experimental data with a true treatment effect, introduce selection bias using the <code>selF</code> selection function, and attempt to recover the true treatment effect using the observed data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">causalTransportR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate RCT</span></span>
<span><span class="va">treatprob</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="co"># workhorse</span></span>
<span><span class="va">dgp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">10000</span>, <span class="va">p</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">treat.prob</span> <span class="op">=</span> <span class="va">treatprob</span>,</span>
<span>                <span class="co"># bounds of X</span></span>
<span>                <span class="va">Xbounds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                <span class="co"># nonlinear heterogeneity</span></span>
<span>                <span class="va">tauF</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                <span class="co"># nonlinear y0</span></span>
<span>                <span class="va">y0F</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                <span class="co"># nonlinear selection</span></span>
<span>                <span class="va">selF</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">X</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span>, <span class="va">Xbounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">Xbounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span></span>
<span>        <span class="va">a</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="va">treat.prob</span><span class="op">)</span></span>
<span>        <span class="co"># generate outcomes using supplied functions</span></span>
<span>        <span class="va">TAU</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span>, <span class="fl">1</span>, <span class="va">tauF</span><span class="op">)</span></span>
<span>        <span class="va">Y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span>, <span class="fl">1</span>, <span class="va">y0F</span><span class="op">)</span></span>
<span>        <span class="va">selscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span>, <span class="fl">1</span>, <span class="va">selF</span><span class="op">)</span></span>
<span>        <span class="co"># outcome</span></span>
<span>        <span class="va">y</span> <span class="op">&lt;&lt;-</span> <span class="op">(</span><span class="va">a</span> <span class="op">*</span> <span class="va">TAU</span> <span class="op">+</span> <span class="va">Y0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="co"># selection</span></span>
<span>        <span class="va">s</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">selscore</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="co"># set outcomes for s = 0 as missing</span></span>
<span>        <span class="va">y</span><span class="op">[</span><span class="va">s</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="cn">NA</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"True effect\n"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">TAU</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># this function populates the global namespace using &lt;&lt;- ; not recommended for real use</span></span>
<span><span class="fu">dgp</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## True effect</span></span>
<span><span class="co">## 1.173934</span></span></code></pre>
<p>We’ve introduced systematic selection bias in the missigness of <code>y</code>. This is plausible in settings where the experimental sample is systematically different from the overall population, or if the missing ‘cohort’ was assigned later and we want to call the experiment earlier based on complete data.</p>
<div class="section level3">
<h3 id="naive">naive<a class="anchor" aria-label="anchor" href="#naive"></a>
</h3>
<p>Using the AIPW estimator naively on complete data is ignoring the missingness problem, and gives us the wrong answer (we know the true effect above is 1.1739339).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n Naive \n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Naive</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ateGT.html">ateGT</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">s</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>, <span class="va">a</span><span class="op">[</span><span class="va">s</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>, <span class="va">X</span><span class="op">[</span><span class="va">s</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>,</span>
<span>        nuisMod <span class="op">=</span> <span class="st">"rlm"</span>, target <span class="op">=</span> <span class="st">"insample"</span>, noi <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span>
<span><span class="va">naive_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      parameter       est         se     ci.ll     ci.ul pval</span></span>
<span><span class="co">## 1      E{Y(0)} 0.3518456 0.02111955 0.3104513 0.3932399    0</span></span>
<span><span class="co">## 2      E{Y(1)} 1.2192154 0.02207557 1.1759473 1.2624836    0</span></span>
<span><span class="co">## 3 E{Y(1)-Y(0)} 0.8673699 0.02864512 0.8112254 0.9235143    0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="corrected-estimators">corrected estimators<a class="anchor" aria-label="anchor" href="#corrected-estimators"></a>
</h2>
<p>Next we demonstrate the use of each of the estimators implemented in <code>ateGT</code> on the simulated data above.</p>
<div class="section level3">
<h3 id="aisw">AISW<a class="anchor" aria-label="anchor" href="#aisw"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAISW \n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## AISW</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aipwfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ateGT.html">ateGT</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">a</span>, <span class="va">X</span>, <span class="va">s</span>,</span>
<span>        treatProb <span class="op">=</span> <span class="va">treatprob</span>, nuisMod <span class="op">=</span> <span class="st">"rlm"</span>,</span>
<span>        estimator <span class="op">=</span> <span class="st">"AISW"</span>, target <span class="op">=</span> <span class="st">"generalize"</span>, noi <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span>
<span><span class="va">aipwfit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">summary</span></span></code></pre></div>
<pre><code><span><span class="co">##      parameter       est         se     ci.ll     ci.ul pval</span></span>
<span><span class="co">## 1      E{Y(0)} 0.2790733 0.03104175 0.2182314 0.3399151    0</span></span>
<span><span class="co">## 2      E{Y(1)} 1.5089650 0.02994849 1.4502659 1.5676640    0</span></span>
<span><span class="co">## 3 E{Y(1)-Y(0)} 1.2298917 0.04250149 1.1465888 1.3131946    0</span></span></code></pre>
<p>As with any reweighting estimator, it is a good idea to study balance. The plot method for the <code>ateGT</code> function produces the following plot, which suggests substantial improvements in balance thanks to selection weights.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aipwfit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<p><img src="generalization_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nISW \n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## ISW</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ipwfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ateGT.html">ateGT</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">a</span>, <span class="va">X</span>, <span class="va">s</span>,</span>
<span>        treatProb <span class="op">=</span> <span class="va">treatprob</span>, nuisMod <span class="op">=</span> <span class="st">"rlm"</span>,</span>
<span>        estimator <span class="op">=</span> <span class="st">"ISW"</span>, target <span class="op">=</span> <span class="st">"generalize"</span>, noi <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in ateGT(y, a, X, s, treatProb = treatprob, nuisMod = "rlm", estimator = "ISW", : Analytic SEs may be inacurrate; use the bootstrap</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ipwfit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">summary</span></span></code></pre></div>
<pre><code><span><span class="co">##      parameter       est         se     ci.ll     ci.ul pval</span></span>
<span><span class="co">## 1      E{Y(0)} 0.2816738 0.03347853 0.2160558 0.3472917    0</span></span>
<span><span class="co">## 2      E{Y(1)} 1.4553181 0.06064194 1.3364599 1.5741763    0</span></span>
<span><span class="co">## 3 E{Y(1)-Y(0)} 1.1736443 0.06985879 1.0367211 1.3105675    0</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nOM \n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## OM</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">omfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ateGT.html">ateGT</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">a</span>, <span class="va">X</span>, <span class="va">s</span>,</span>
<span>        treatProb <span class="op">=</span> <span class="va">treatprob</span>, nuisMod <span class="op">=</span> <span class="st">"rlm"</span>,</span>
<span>        estimator <span class="op">=</span> <span class="st">"OM"</span>, target <span class="op">=</span> <span class="st">"generalize"</span>, noi <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in ateGT(y, a, X, s, treatProb = treatprob, nuisMod = "rlm", estimator = "OM", : Analytic SEs may be inacurrate; use the bootstrap</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">omfit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">summary</span></span></code></pre></div>
<pre><code><span><span class="co">##      parameter       est          se     ci.ll     ci.ul pval</span></span>
<span><span class="co">## 1      E{Y(0)} 0.3034576 0.005016487 0.2936253 0.3132899    0</span></span>
<span><span class="co">## 2      E{Y(1)} 1.4439125 0.007368723 1.4294698 1.4583552    0</span></span>
<span><span class="co">## 3 E{Y(1)-Y(0)} 1.1404549 0.005082201 1.1304938 1.1504160    0</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nACW \n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## ACW</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acwfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ateGT.html">ateGT</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">a</span>, <span class="fu"><a href="../reference/polySieveM.html">polySieveM</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="va">s</span>,</span>
<span>        treatProb <span class="op">=</span> <span class="va">treatprob</span>, nuisMod <span class="op">=</span> <span class="st">"rlm"</span>,</span>
<span>        estimator <span class="op">=</span> <span class="st">"ACW"</span>, target <span class="op">=</span> <span class="st">"generalize"</span>, noi <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in ateGT(y, a, polySieveM(X), s, treatProb = treatprob, nuisMod = "rlm", : Analytic SEs may be inacurrate; use the bootstrap</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acwfit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">summary</span></span></code></pre></div>
<pre><code><span><span class="co">##      parameter      est         se     ci.ll     ci.ul pval</span></span>
<span><span class="co">## 1      E{Y(0)} 0.293218 0.02009422 0.2538333 0.3326026    0</span></span>
<span><span class="co">## 2      E{Y(1)} 1.490452 0.01966189 1.4519143 1.5289889    0</span></span>
<span><span class="co">## 3 E{Y(1)-Y(0)} 1.197234 0.02699272 1.1443279 1.2501394    0</span></span></code></pre>
<p>We do better than the naive approach in all these cases.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Apoorva Lal.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
